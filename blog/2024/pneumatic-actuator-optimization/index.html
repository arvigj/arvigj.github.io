<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Cascaded Shape Optimization using PolyFEM | Arvi Gjoka </title> <meta name="author" content="Arvi Gjoka"> <meta name="description" content="A tutorial for setting up shape optimization of pneumatic robots"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://arvigj.github.io/blog/2024/pneumatic-actuator-optimization/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Arvi</span> Gjoka </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Cascaded Shape Optimization using PolyFEM</h1> <p class="post-meta"> Created in July 07, 2024 </p> <p class="post-tags"> <a href="/blog/2024"> <i class="fa-solid fa-calendar fa-sm"></i> 2024 </a>   ·   <a href="/blog/tag/formatting"> <i class="fa-solid fa-hashtag fa-sm"></i> formatting</a>   <a href="/blog/tag/math"> <i class="fa-solid fa-hashtag fa-sm"></i> math</a>   ·   <a href="/blog/category/optimization"> <i class="fa-solid fa-tag fa-sm"></i> optimization</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="cascaded-shape-optimization-using-polyfem-draft-in-progress">Cascaded Shape Optimization using PolyFEM (Draft In Progress)</h1> <p><strong><em>A tutorial for setting up shape optimization of pneumatic robots, with <a href="https://github.com/arvigj/pneumatic-actuator-design" rel="external nofollow noopener" target="_blank">full examples</a></em></strong></p> <p>In this tutorial, I’ll be outlining how to setup the shape optimization from the paper <a href="https://cims.nyu.edu/gcl/papers/2024-pneumatic.pdf" rel="external nofollow noopener" target="_blank">‘Soft Pneumatic Actuator Design using Differentiable Simulation’</a>. I’ll be assuming familiarity with the paper, including the finite element method and optimization in general. For a background into these topics, there will be a blog post in the future. We will be using the differentiable finite element simulator <a href="https://github.com/polyfem/polyfem" rel="external nofollow noopener" target="_blank">PolyFEM</a>, which has support for high order basis, a multitude of material models, physical energies and state-of-the-art contact/friction (<a href="https://github.com/ipc-sim/ipc-toolkit" rel="external nofollow noopener" target="_blank">IPC</a>). The cascading algorithm is implemented in Python and can be found <a href="https://github.com/arvigj/pneumatic-actuator-design" rel="external nofollow noopener" target="_blank">with the configuration files</a>. <a href="https://www.mmgtools.org" rel="external nofollow noopener" target="_blank">MMG</a> is also required for interior remeshing.</p> <h2 id="simulation-setup">Simulation Setup</h2> <p>Readers should take a look at the <a href="https://polyfem.github.io/tutorials/getting_started/" rel="external nofollow noopener" target="_blank">PolyFEM docs</a> for complete tutorials on setting up a simulation, with a full breakdown of features, options for contact, solvers, output, etc. For this section, we will focus on some requirements for the simulation: the mesh, surface selections and boundary conditions.</p> <h3 id="mesh">Mesh</h3> <p>A finite element simulation requires a volumetric mesh. This can be created from a surface mesh using <a href="https://github.com/wildmeshing/fTetWild" rel="external nofollow noopener" target="_blank">fTetWild</a>, which exposes a lot of control over mesh quality. Alternatively, if designed in CAD, volumetric meshes are directly available.</p> <h3 id="surface-selections">Surface selections</h3> <p>We provide a utility to select surface based on bounding volumes. Given a volumetric mesh and surface meshes bounding surfaces of interest, our utility in <code class="language-plaintext highlighter-rouge">setup_scene_3d/setup_3d.cpp</code> computes the surface selections and assigns distinct ids for use in the simulation. The output is a <code class="language-plaintext highlighter-rouge">.txt</code> file mapping surface triangles to boundary ids.</p> <h3 id="boundary-conditions">Boundary conditions</h3> <p>Once you’ve marked the surface selections and specified them in the json, you can use them as boundary conditions.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"boundary_conditions": {
    "dirichlet_boundary": [{
        "id": 0,
        "value": [0, 0, 0]
    }],
    "pressure_boundary": [{
        "id": 1,
        "value": "min(-4000 * t, -4000)"
    }]
}
</code></pre></div></div> <p>Dirichlet boundary conditions require a specification of a displacement vector \([x, y, z]\) whereas pressure boundary conditions only require a pressure scalar that is applied normal to the surface \(p \, \hat{n}\). PolyFEM also accepts functions of \(x, y, z, t\) as boundary condition values, allowing pressure to be varied over time as the linear ramp <code class="language-plaintext highlighter-rouge">min(-4000 * t, -4000)</code>. There are other functions available and boundary conditions can also be specified per timestep (see worm example).</p> <p><strong>Important Note About Simulation:</strong> For mathematical reasons, the boundary loop of a surface with applied pressure must be either held constant with Dirichlet b.c. or the whole surface must be closed.</p> <h2 id="optimization-setup">Optimization Setup</h2> <p>Once the simulation is setup, setting up the optimization requires specifying:</p> <ol> <li>The parameters being optimized and their starting values.</li> <li>The parametrizations mapping the parameters to simulation variables, i.e. quantities that the simulation directly uses. In the case of simply optimizing vertex positions, the parametrization is the identity map.</li> <li>The optimization objectives, which can be a list of summed functionals. While there are many of them and new ones are constantly added in PolyFEM, the ones we will detail are: <ul> <li> <code class="language-plaintext highlighter-rouge">mesh-target</code> – <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> {
  "type": "mesh-target",
  "state": 0,
  "surface_selection": [
      4
  ],
  "mesh_path": "cylinder_smaller_target_v2.obj",
  "delta": 0.001
 }
</code></pre></div> </div> </li> <li><code class="language-plaintext highlighter-rouge">log_contact_force_norm</code></li> <li><code class="language-plaintext highlighter-rouge">layer_thickness</code></li> <li> <code class="language-plaintext highlighter-rouge">transient_integral</code> – This objective is needed to wrap all of our other objectives, which are effectively static objectives (for a given displacement at time t). Through this objective, one can specify a timestep to evaluate the static objectives or evaluate them over the course of the simulation. The syntax looks as follows, with the static objective being surface matching to a mesh evaluated at time steps 53 and 54: ``` { “type”: “transient_integral”, “weight”: -1e4, “integral_type”: “steps”, “steps”: [ 53, 54 ], “state”: 0, “static_objective”: { “type”: “mesh-target”, … } }</li> </ul> <p>```</p> <ul> <li> <code class="language-plaintext highlighter-rouge">collision_barrier</code> – Since we’re using a quadratic barrier in our <code class="language-plaintext highlighter-rouge">layer_thickness</code> objective, we might want to add a “hard” constraint to prevent surfaces going through one another. If we keep the support of this objective small, we can ensure that the optimization does not reach an invalid state while preventing this objective from really contributing to the energy. This objective is not crucial to the optimization and can be left out.</li> </ul> </li> </ol> <h2 id="cascaded-optimization">Cascaded Optimization</h2> <p>At this point, you can add the new optimization info to the <code class="language-plaintext highlighter-rouge">OPTIMIZATIONS</code> dict in <code class="language-plaintext highlighter-rouge">multigrid_optimization.py</code>. Using a key <code class="language-plaintext highlighter-rouge">&lt;example_key&gt;</code>, the necessary fields are:</p> <p><code class="language-plaintext highlighter-rouge">base_path</code>: The base directory for the optimization files, where the results will be stored.</p> <p><code class="language-plaintext highlighter-rouge">state_path</code>: The filename of the simulation json.</p> <p><code class="language-plaintext highlighter-rouge">run_path</code>: The filename of the optimization json.</p> <p><code class="language-plaintext highlighter-rouge">num_control_points</code>: For each of the surfaces being optimized, this specified the degrees of freedom for each optimization step. It is zero indexed starting with the first parameter in the optimization json.</p> <p><code class="language-plaintext highlighter-rouge">num_iters</code>: Specifies the number of iterations for each optimization step.</p> <p><code class="language-plaintext highlighter-rouge">opt_mesh_idx</code>: Specifies the index of the mesh being indexed in the simulation json, in the <code class="language-plaintext highlighter-rouge">geometry</code> section.</p> <p><code class="language-plaintext highlighter-rouge">aux_files</code>: Specifies the auxiliary files that are copied to the run directory, such as mesh targets, etc.</p> <p><code class="language-plaintext highlighter-rouge">threads</code>: Number of threads that the forward simulation is allowed.</p> <p>The optimization can then be executed by the following command</p> <p><code class="language-plaintext highlighter-rouge">python multigrid_optimization.py &lt;example_key&gt; &lt;run_path&gt; &lt;polyfem_build_dir&gt; &lt;mmg_build_dir&gt; &lt;absolute_path&gt; L-BFGS</code></p> </div> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2024 Arvi Gjoka. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.min.js" integrity="sha256-rjmgmaB99riUNcdlrDtcAiwtLIojSxNyUFdl+Qh+rB4=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>addBackToTop();</script> <script type="module" src="/assets/js/search/ninja-keys.min.js?601a2d3465e2a52bec38b600518d5f70"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script>let searchTheme=determineComputedTheme();const ninjaKeys=document.querySelector("ninja-keys");"dark"===searchTheme?ninjaKeys.classList.add("dark"):ninjaKeys.classList.remove("dark");const openSearchModal=()=>{const e=$("#navbarNav");e.hasClass("show")&&e.collapse("hide"),ninjaKeys.open()};</script> <script>const ninja=document.querySelector("ninja-keys");ninja.data=[{id:"nav-about",title:"about",section:"Navigation",handler:()=>{window.location.href="/"}},{id:"nav-blog",title:"blog",description:"",section:"Navigation",handler:()=>{window.location.href="/blog/"}},{id:"nav-publications",title:"publications",description:"publications by categories in reversed chronological order. generated by jekyll-scholar.",section:"Navigation",handler:()=>{window.location.href="/publications/"}},{id:"nav-repositories",title:"repositories",description:"",section:"Navigation",handler:()=>{window.location.href="/repositories/"}},{id:"post-cascaded-shape-optimization-using-polyfem",title:"Cascaded Shape Optimization using PolyFEM",description:"A tutorial for setting up shape optimization of pneumatic robots",section:"Posts",handler:()=>{window.location.href="/blog/2024/pneumatic-actuator-optimization/"}},{id:"news-a-simple-inline-announcement-with-markdown-emoji-sparkles-smile",title:'A simple inline announcement with Markdown emoji! <img class="emoji" title=":sparkles:" alt=":sparkles:" src="https://github.githubassets.com/images/icons/emoji/unicode/2728.png" height="20" width="20"> <img class="emoji" title=":smile:" alt=":smile:" src="https://github.githubassets.com/images/icons/emoji/unicode/1f604.png" height="20" width="20">',description:"",section:"News"},{id:"news-a-long-announcement-with-details",title:"A long announcement with details",description:"",section:"News",handler:()=>{window.location.href="/news/announcement_2/"}},{id:"news-a-simple-inline-announcement",title:"A simple inline announcement.",description:"",section:"News"},{id:"projects-project-1",title:"project 1",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/1_project/"}},{id:"projects-project-2",title:"project 2",description:"a project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/2_project/"}},{id:"projects-project-3-with-very-long-name",title:"project 3 with very long name",description:"a project that redirects to another website",section:"Projects",handler:()=>{window.location.href="/projects/3_project/"}},{id:"projects-project-4",title:"project 4",description:"another without an image",section:"Projects",handler:()=>{window.location.href="/projects/4_project/"}},{id:"projects-project-5",title:"project 5",description:"a project with a background image",section:"Projects",handler:()=>{window.location.href="/projects/5_project/"}},{id:"projects-project-6",title:"project 6",description:"a project with no image",section:"Projects",handler:()=>{window.location.href="/projects/6_project/"}},{id:"projects-project-7",title:"project 7",description:"with background image",section:"Projects",handler:()=>{window.location.href="/projects/7_project/"}},{id:"projects-project-8",title:"project 8",description:"an other project with a background image and giscus comments",section:"Projects",handler:()=>{window.location.href="/projects/8_project/"}},{id:"projects-project-9",title:"project 9",description:"another project with an image \ud83c\udf89",section:"Projects",handler:()=>{window.location.href="/projects/9_project/"}},{id:"socials-google-scholar",title:"Google Scholar",section:"Socials",handler:()=>{window.open("https://scholar.google.com/citations?user=BPmAujIAAAAJ","_blank")}},{id:"socials-github",title:"GitHub",section:"Socials",handler:()=>{window.open("https://github.com/arvigj","_blank")}},{id:"light-theme",title:"Change theme to light",description:"Change the theme of the site to Light",section:"Theme",handler:()=>{setThemeSetting("light")}},{id:"dark-theme",title:"Change theme to dark",description:"Change the theme of the site to Dark",section:"Theme",handler:()=>{setThemeSetting("dark")}},{id:"system-theme",title:"Use system default theme",description:"Change the theme of the site to System Default",section:"Theme",handler:()=>{setThemeSetting("system")}}];</script> <script src="/assets/js/shortcut-key.js"></script> </body> </html>